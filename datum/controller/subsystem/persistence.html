<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <base href="../../../" />
    <link rel="stylesheet" href="dmdoc.css" />
    <title>&#x2F;datum&#x2F;controller&#x2F;subsystem&#x2F;persistence - Space Station 13 - Nebula13</title>
</head>
<body>
<header>
    <a href="index.html">Space Station 13 - Nebula13</a> -
    <a href="index.html#modules">Modules</a> -
    <a href="index.html#types">Types</a>
 &mdash; <a href="datum/controller/subsystem/persistence.html#var">Var Details</a> - <a href="datum/controller/subsystem/persistence.html#proc">Proc Details</a></header>
<main>
<h1>persistence <aside>/<a href="datum.html">datum</a>/<a href="datum/controller/subsystem.html">controller/subsystem</a>/<a href="datum/controller/subsystem/persistence.html">persistence</a></aside>
        
    
            <a href="https://github.com/PersistentSS13/Nebula/blob/7b6f8493c22b657b410323bc01d7f2917a09e590/code/controllers/subsystems/initialization/persistence.dm#L1">
        <img src="git.png" width="16" height="16" title="code&#x2F;controllers&#x2F;subsystems&#x2F;initialization&#x2F;persistence.dm 1"/></a></h1>

<p>Override of the persistence subsystem for handling saving the entire world.</p><table class="summary" cellspacing="0"><tr><td colspan="2"><h2>Vars</h2></td></tr>
            <tr><th><a href="datum/controller/subsystem/persistence.html#var/error_tolerance">error_tolerance</a></th><td>If set, we'll do everything we can to generate a valid save even if some things do runtime.</td></tr>
            <tr><th><a href="datum/controller/subsystem/persistence.html#var/in_loaded_world">in_loaded_world</a></th><td>Whether or not we're currently running a loaded save.</td></tr>
            <tr><th><a href="datum/controller/subsystem/persistence.html#var/late_wrappers">late_wrappers</a></th><td>Some wrapped objects need special behavior post-load. This list is cleared post-atom Init.</td></tr>
            <tr><th><a href="datum/controller/subsystem/persistence.html#var/limbo_refs">limbo_refs</a></th><td>Objects which are deserialized out of limbo don't have their refs in the database immediately, so we add them here until the next save. Format is p_id -&gt; ref</td></tr>
            <tr><th><a href="datum/controller/subsystem/persistence.html#var/limbo_removals">limbo_removals</a></th><td>Objects which will be removed from limbo on the next save. Format is list(limbo_key, limbo_type)</td></tr>
            <tr><th><a href="datum/controller/subsystem/persistence.html#var/loaded_save_time">loaded_save_time</a></th><td>The time when the currently loaded world save was made if any. NULL means we never loaded a save.</td></tr>
            <tr><th><a href="datum/controller/subsystem/persistence.html#var/loading_world">loading_world</a></th><td>Whether we're currently loading a world save.</td></tr>
            <tr><th><a href="datum/controller/subsystem/persistence.html#var/nb_saved_atoms">nb_saved_atoms</a></th><td>Amount of atoms saved</td></tr>
            <tr><th><a href="datum/controller/subsystem/persistence.html#var/nb_saved_z_levels">nb_saved_z_levels</a></th><td>Amount of z-levels saved</td></tr>
            <tr><th><a href="datum/controller/subsystem/persistence.html#var/one_off">one_off</a></th><td>The serializer impl for one off serialization/deserialization.</td></tr>
            <tr><th><a href="datum/controller/subsystem/persistence.html#var/rent_enabled">rent_enabled</a></th><td>Whether or not rent will be required for created sectors.</td></tr>
            <tr><th><a href="datum/controller/subsystem/persistence.html#var/save_complete_span_class">save_complete_span_class</a></th><td>Span class to use for displaying the completion/failure message into chat.</td></tr>
            <tr><th><a href="datum/controller/subsystem/persistence.html#var/save_complete_text">save_complete_text</a></th><td>Text to log into the database log for the completion/failure of the save</td></tr>
            <tr><th><a href="datum/controller/subsystem/persistence.html#var/save_exists">save_exists</a></th><td>Whether or not a save exists in the DB. Value is cached when a save did exist at runtime for performance reasons.</td></tr>
            <tr><th><a href="datum/controller/subsystem/persistence.html#var/save_log_id">save_log_id</a></th><td>Save log entry index from the database for the currently running save. Used to fill in the saving result into the db.</td></tr>
            <tr><th><a href="datum/controller/subsystem/persistence.html#var/saved_extensions">saved_extensions</a></th><td>Extensions mark themselves to be saved on world save.</td></tr>
            <tr><th><a href="datum/controller/subsystem/persistence.html#var/saved_levels">saved_levels</a></th><td>Saved levels are saved entirely and optimized with get_base_turf()</td></tr>
            <tr><th><a href="datum/controller/subsystem/persistence.html#var/serializer">serializer</a></th><td>The serializer impl for actually saving.</td></tr>
            <tr><th><a href="datum/controller/subsystem/persistence.html#var/was_entering_allowed">was_entering_allowed</a></th><td>Holds the previous entering allowed state while we're running a save.</td></tr><tr><td colspan="2"><h2>Procs</h2></td></tr>
            <tr><th><a href="datum/controller/subsystem/persistence.html#proc/AddToLimbo">AddToLimbo</a></th><td>Add something to the off-world save.</td></tr>
            <tr><th><a href="datum/controller/subsystem/persistence.html#proc/LoadFromLimbo">LoadFromLimbo</a></th><td>Load something from the off-world save.</td></tr>
            <tr><th><a href="datum/controller/subsystem/persistence.html#proc/LoadWorld">LoadWorld</a></th><td>Load the last saved world.</td></tr>
            <tr><th><a href="datum/controller/subsystem/persistence.html#proc/LoadedSaveTimestamp">LoadedSaveTimestamp</a></th><td>Timestamp of when the currently loaded save was made.</td></tr>
            <tr><th><a href="datum/controller/subsystem/persistence.html#proc/PrintDBStatus">PrintDBStatus</a></th><td>Prints a description of the tables on the connected database into the chat for the usr calling this proc.</td></tr>
            <tr><th><a href="datum/controller/subsystem/persistence.html#proc/RemoveFromLimbo">RemoveFromLimbo</a></th><td>Remove something from the off-world save.</td></tr>
            <tr><th><a href="datum/controller/subsystem/persistence.html#proc/SaveExists">SaveExists</a></th><td>Returns true if a save already exists on the DB</td></tr>
            <tr><th><a href="datum/controller/subsystem/persistence.html#proc/SaveWorld">SaveWorld</a></th><td>Causes a world save to be started.</td></tr>
            <tr><th><a href="datum/controller/subsystem/persistence.html#proc/SetErrorTolerance">SetErrorTolerance</a></th><td>Sets the level of error tolerance to use during saves/loads. Default is PERSISTENCE_ERROR_TOLERANCE_NONE.</td></tr>
            <tr><th><a href="datum/controller/subsystem/persistence.html#proc/_after_save">_after_save</a></th><td>Runs the post-saving stuff</td></tr>
            <tr><th><a href="datum/controller/subsystem/persistence.html#proc/_apply_area_chunks">_apply_area_chunks</a></th><td>Applies areas to both loaded and default turfs inside the regions they cover.</td></tr>
            <tr><th><a href="datum/controller/subsystem/persistence.html#proc/_before_load">_before_load</a></th><td>Handles setting up db connections and etc..</td></tr>
            <tr><th><a href="datum/controller/subsystem/persistence.html#proc/_before_save">_before_save</a></th><td>Run the pre-save stuff</td></tr>
            <tr><th><a href="datum/controller/subsystem/persistence.html#proc/_block_entering">_block_entering</a></th><td>Keeps the previous state of 'enter_allowed' and set it to false. Returns TRUE if entering was currently allowed.</td></tr>
            <tr><th><a href="datum/controller/subsystem/persistence.html#proc/_deserialize_turfs">_deserialize_turfs</a></th><td>Deserialize cached top level wrapper datum/turf exclusively from the db cache.</td></tr>
            <tr><th><a href="datum/controller/subsystem/persistence.html#proc/_handle_critical_load_exception">_handle_critical_load_exception</a></th><td>Call in a catch block for critical/typically unrecoverable errors during load. Filters out the kind of exceptions we let through or not.</td></tr>
            <tr><th><a href="datum/controller/subsystem/persistence.html#proc/_handle_critical_save_exception">_handle_critical_save_exception</a></th><td>Call in a catch block for critical/typically unrecoverable errors during save. Filters out the kind of exceptions we let through or not.</td></tr>
            <tr><th><a href="datum/controller/subsystem/persistence.html#proc/_handle_recoverable_load_exception">_handle_recoverable_load_exception</a></th><td>Call in a catch block for recoverable or non-critical errors during load. Filters out the kind of exceptions we let through or not.</td></tr>
            <tr><th><a href="datum/controller/subsystem/persistence.html#proc/_handle_recoverable_save_exception">_handle_recoverable_save_exception</a></th><td>Call in a catch block for recoverable or non-critical errors during save. Filters out the kind of exceptions we let through or not.</td></tr>
            <tr><th><a href="datum/controller/subsystem/persistence.html#proc/_pause_subsystems">_pause_subsystems</a></th><td>Handle pausing all subsystems before save</td></tr>
            <tr><th><a href="datum/controller/subsystem/persistence.html#proc/_restore_entering">_restore_entering</a></th><td>Restore the previous state of 'enter_allowed'. Returns the restored value of 'enter_allowed'.</td></tr>
            <tr><th><a href="datum/controller/subsystem/persistence.html#proc/_restore_zlevel_structure">_restore_zlevel_structure</a></th><td>Assign the right z-level index to the right level.</td></tr>
            <tr><th><a href="datum/controller/subsystem/persistence.html#proc/_resume_subsystems">_resume_subsystems</a></th><td>Handles resuming all subsystems post-save</td></tr>
            <tr><th><a href="datum/controller/subsystem/persistence.html#proc/_run_after_deserialize">_run_after_deserialize</a></th><td>Sort z-levels on whether they got a mapped z indice, or not
Runs after deserialize on all the loaded atoms.</td></tr>
            <tr><th><a href="datum/controller/subsystem/persistence.html#proc/_save_areas">_save_areas</a></th><td>Amount of turfs waiting for a commit
The total count of zlevels we're saving
Saves area stuff</td></tr>
            <tr><th><a href="datum/controller/subsystem/persistence.html#proc/_save_bank_accounts">_save_bank_accounts</a></th><td>Save bank account stuff</td></tr>
            <tr><th><a href="datum/controller/subsystem/persistence.html#proc/_save_extensions">_save_extensions</a></th><td>Saves extension wrapper stuff</td></tr>
            <tr><th><a href="datum/controller/subsystem/persistence.html#proc/_save_turfs">_save_turfs</a></th><td>Saves all the turfs marked for saving in the world.
!!!!!!!!!!!!!!!!!!!!!!!
! - HOT CODE BELOW - !!
!!!!!!!!!!!!!!!!!!!!!!!</td></tr>
            <tr><th><a href="datum/controller/subsystem/persistence.html#proc/_setup_default_turfs">_setup_default_turfs</a></th><td>TODO</td></tr>
            <tr><th><a href="datum/controller/subsystem/persistence.html#proc/_update_limbo_state">_update_limbo_state</a></th><td>Clean up limbo by removing any characters present in the gameworld. This may occur if the server does not save after
a player enters limbo.</td></tr>
            <tr><th><a href="datum/controller/subsystem/persistence.html#proc/prepare_atmos_for_save">prepare_atmos_for_save</a></th><td>Make atmos store it's air values so we can properly save them per atmos atom.</td></tr>
            <tr><th><a href="datum/controller/subsystem/persistence.html#proc/prepare_limbo_for_save">prepare_limbo_for_save</a></th><td>Update the list of things in limbo and not in limbo, so they don't get saved in 2 different states.</td></tr></table>
    <h2 id="var">Var Details</h2><h3 id="var/error_tolerance"><aside class="declaration">var </aside>error_tolerance
            <aside>&ndash; </aside>
        
    
            <a href="https://github.com/PersistentSS13/Nebula/blob/7b6f8493c22b657b410323bc01d7f2917a09e590/maps/outreach/../../mods/persistence/controllers/subsystems/persistence.dm#L37">
        <img src="git.png" width="16" height="16" title="maps&#x2F;outreach&#x2F;..&#x2F;..&#x2F;mods&#x2F;persistence&#x2F;controllers&#x2F;subsystems&#x2F;persistence.dm 37"/></a></h3>
        <p>If set, we'll do everything we can to generate a valid save even if some things do runtime.</p><h3 id="var/in_loaded_world"><aside class="declaration">var </aside>in_loaded_world
            <aside>&ndash; </aside>
        
    
            <a href="https://github.com/PersistentSS13/Nebula/blob/7b6f8493c22b657b410323bc01d7f2917a09e590/maps/outreach/../../mods/persistence/controllers/subsystems/persistence.dm#L44">
        <img src="git.png" width="16" height="16" title="maps&#x2F;outreach&#x2F;..&#x2F;..&#x2F;mods&#x2F;persistence&#x2F;controllers&#x2F;subsystems&#x2F;persistence.dm 44"/></a></h3>
        <p>Whether or not we're currently running a loaded save.</p><h3 id="var/late_wrappers"><aside class="declaration">var </aside>late_wrappers
            <aside>&ndash; /list</aside>
        
    
            <a href="https://github.com/PersistentSS13/Nebula/blob/7b6f8493c22b657b410323bc01d7f2917a09e590/maps/outreach/../../mods/persistence/controllers/subsystems/persistence.dm#L86">
        <img src="git.png" width="16" height="16" title="maps&#x2F;outreach&#x2F;..&#x2F;..&#x2F;mods&#x2F;persistence&#x2F;controllers&#x2F;subsystems&#x2F;persistence.dm 86"/></a></h3>
        <p>Some wrapped objects need special behavior post-load. This list is cleared post-atom Init.</p><h3 id="var/limbo_refs"><aside class="declaration">var </aside>limbo_refs
            <aside>&ndash; /list</aside>
        
    
            <a href="https://github.com/PersistentSS13/Nebula/blob/7b6f8493c22b657b410323bc01d7f2917a09e590/maps/outreach/../../mods/persistence/controllers/subsystems/persistence.dm#L83">
        <img src="git.png" width="16" height="16" title="maps&#x2F;outreach&#x2F;..&#x2F;..&#x2F;mods&#x2F;persistence&#x2F;controllers&#x2F;subsystems&#x2F;persistence.dm 83"/></a></h3>
        <p>Objects which are deserialized out of limbo don't have their refs in the database immediately, so we add them here until the next save. Format is p_id -&gt; ref</p><h3 id="var/limbo_removals"><aside class="declaration">var </aside>limbo_removals
            <aside>&ndash; /list</aside>
        
    
            <a href="https://github.com/PersistentSS13/Nebula/blob/7b6f8493c22b657b410323bc01d7f2917a09e590/maps/outreach/../../mods/persistence/controllers/subsystems/persistence.dm#L81">
        <img src="git.png" width="16" height="16" title="maps&#x2F;outreach&#x2F;..&#x2F;..&#x2F;mods&#x2F;persistence&#x2F;controllers&#x2F;subsystems&#x2F;persistence.dm 81"/></a></h3>
        <p>Objects which will be removed from limbo on the next save. Format is list(limbo_key, limbo_type)</p><h3 id="var/loaded_save_time"><aside class="declaration">var </aside>loaded_save_time
            <aside>&ndash; </aside>
        
    
            <a href="https://github.com/PersistentSS13/Nebula/blob/7b6f8493c22b657b410323bc01d7f2917a09e590/maps/outreach/../../mods/persistence/controllers/subsystems/persistence.dm#L48">
        <img src="git.png" width="16" height="16" title="maps&#x2F;outreach&#x2F;..&#x2F;..&#x2F;mods&#x2F;persistence&#x2F;controllers&#x2F;subsystems&#x2F;persistence.dm 48"/></a></h3>
        <p>The time when the currently loaded world save was made if any. NULL means we never loaded a save.</p><h3 id="var/loading_world"><aside class="declaration">var </aside>loading_world
            <aside>&ndash; </aside>
        
    
            <a href="https://github.com/PersistentSS13/Nebula/blob/7b6f8493c22b657b410323bc01d7f2917a09e590/maps/outreach/../../mods/persistence/controllers/subsystems/persistence.dm#L46">
        <img src="git.png" width="16" height="16" title="maps&#x2F;outreach&#x2F;..&#x2F;..&#x2F;mods&#x2F;persistence&#x2F;controllers&#x2F;subsystems&#x2F;persistence.dm 46"/></a></h3>
        <p>Whether we're currently loading a world save.</p><h3 id="var/nb_saved_atoms"><aside class="declaration">var </aside>nb_saved_atoms
            <aside>&ndash; </aside>
        
    
            <a href="https://github.com/PersistentSS13/Nebula/blob/7b6f8493c22b657b410323bc01d7f2917a09e590/maps/outreach/../../mods/persistence/controllers/subsystems/persistence.dm#L61">
        <img src="git.png" width="16" height="16" title="maps&#x2F;outreach&#x2F;..&#x2F;..&#x2F;mods&#x2F;persistence&#x2F;controllers&#x2F;subsystems&#x2F;persistence.dm 61"/></a></h3>
        <p>Amount of atoms saved</p><h3 id="var/nb_saved_z_levels"><aside class="declaration">var </aside>nb_saved_z_levels
            <aside>&ndash; </aside>
        
    
            <a href="https://github.com/PersistentSS13/Nebula/blob/7b6f8493c22b657b410323bc01d7f2917a09e590/maps/outreach/../../mods/persistence/controllers/subsystems/persistence.dm#L59">
        <img src="git.png" width="16" height="16" title="maps&#x2F;outreach&#x2F;..&#x2F;..&#x2F;mods&#x2F;persistence&#x2F;controllers&#x2F;subsystems&#x2F;persistence.dm 59"/></a></h3>
        <p>Amount of z-levels saved</p><h3 id="var/one_off"><aside class="declaration">var </aside>one_off
            <aside>&ndash; /<a href="serializer.html">serializer</a>/<a href="serializer/sql.html">sql</a>/<a href="serializer/sql/one_off.html">one_off</a></aside>
        
    
            <a href="https://github.com/PersistentSS13/Nebula/blob/7b6f8493c22b657b410323bc01d7f2917a09e590/maps/outreach/../../mods/persistence/controllers/subsystems/persistence.dm#L76">
        <img src="git.png" width="16" height="16" title="maps&#x2F;outreach&#x2F;..&#x2F;..&#x2F;mods&#x2F;persistence&#x2F;controllers&#x2F;subsystems&#x2F;persistence.dm 76"/></a></h3>
        <p>The serializer impl for one off serialization/deserialization.</p><h3 id="var/rent_enabled"><aside class="declaration">var </aside>rent_enabled
            <aside>&ndash; </aside>
        
    
            <a href="https://github.com/PersistentSS13/Nebula/blob/7b6f8493c22b657b410323bc01d7f2917a09e590/maps/outreach/../../mods/persistence/controllers/subsystems/persistence.dm#L35">
        <img src="git.png" width="16" height="16" title="maps&#x2F;outreach&#x2F;..&#x2F;..&#x2F;mods&#x2F;persistence&#x2F;controllers&#x2F;subsystems&#x2F;persistence.dm 35"/></a></h3>
        <p>Whether or not rent will be required for created sectors.</p><h3 id="var/save_complete_span_class"><aside class="declaration">var </aside>save_complete_span_class
            <aside>&ndash; </aside>
        
    
            <a href="https://github.com/PersistentSS13/Nebula/blob/7b6f8493c22b657b410323bc01d7f2917a09e590/maps/outreach/../../mods/persistence/controllers/subsystems/persistence.dm#L57">
        <img src="git.png" width="16" height="16" title="maps&#x2F;outreach&#x2F;..&#x2F;..&#x2F;mods&#x2F;persistence&#x2F;controllers&#x2F;subsystems&#x2F;persistence.dm 57"/></a></h3>
        <p>Span class to use for displaying the completion/failure message into chat.</p><h3 id="var/save_complete_text"><aside class="declaration">var </aside>save_complete_text
            <aside>&ndash; </aside>
        
    
            <a href="https://github.com/PersistentSS13/Nebula/blob/7b6f8493c22b657b410323bc01d7f2917a09e590/maps/outreach/../../mods/persistence/controllers/subsystems/persistence.dm#L55">
        <img src="git.png" width="16" height="16" title="maps&#x2F;outreach&#x2F;..&#x2F;..&#x2F;mods&#x2F;persistence&#x2F;controllers&#x2F;subsystems&#x2F;persistence.dm 55"/></a></h3>
        <p>Text to log into the database log for the completion/failure of the save</p><h3 id="var/save_exists"><aside class="declaration">var </aside>save_exists
            <aside>&ndash; </aside>
        
    
            <a href="https://github.com/PersistentSS13/Nebula/blob/7b6f8493c22b657b410323bc01d7f2917a09e590/maps/outreach/../../mods/persistence/controllers/subsystems/persistence.dm#L42">
        <img src="git.png" width="16" height="16" title="maps&#x2F;outreach&#x2F;..&#x2F;..&#x2F;mods&#x2F;persistence&#x2F;controllers&#x2F;subsystems&#x2F;persistence.dm 42"/></a></h3>
        <p>Whether or not a save exists in the DB. Value is cached when a save did exist at runtime for performance reasons.</p><h3 id="var/save_log_id"><aside class="declaration">var </aside>save_log_id
            <aside>&ndash; </aside>
        
    
            <a href="https://github.com/PersistentSS13/Nebula/blob/7b6f8493c22b657b410323bc01d7f2917a09e590/maps/outreach/../../mods/persistence/controllers/subsystems/persistence.dm#L50">
        <img src="git.png" width="16" height="16" title="maps&#x2F;outreach&#x2F;..&#x2F;..&#x2F;mods&#x2F;persistence&#x2F;controllers&#x2F;subsystems&#x2F;persistence.dm 50"/></a></h3>
        <p>Save log entry index from the database for the currently running save. Used to fill in the saving result into the db.</p><h3 id="var/saved_extensions"><aside class="declaration">var </aside>saved_extensions
            <aside>&ndash; /list</aside>
        
    
            <a href="https://github.com/PersistentSS13/Nebula/blob/7b6f8493c22b657b410323bc01d7f2917a09e590/maps/outreach/../../mods/persistence/controllers/subsystems/persistence.dm#L68">
        <img src="git.png" width="16" height="16" title="maps&#x2F;outreach&#x2F;..&#x2F;..&#x2F;mods&#x2F;persistence&#x2F;controllers&#x2F;subsystems&#x2F;persistence.dm 68"/></a></h3>
        <p>Extensions mark themselves to be saved on world save.</p><h3 id="var/saved_levels"><aside class="declaration">var </aside>saved_levels
            <aside>&ndash; /list</aside>
        
    
            <a href="https://github.com/PersistentSS13/Nebula/blob/7b6f8493c22b657b410323bc01d7f2917a09e590/maps/outreach/../../mods/persistence/controllers/subsystems/persistence.dm#L66">
        <img src="git.png" width="16" height="16" title="maps&#x2F;outreach&#x2F;..&#x2F;..&#x2F;mods&#x2F;persistence&#x2F;controllers&#x2F;subsystems&#x2F;persistence.dm 66"/></a></h3>
        <p>Saved levels are saved entirely and optimized with get_base_turf()</p><h3 id="var/serializer"><aside class="declaration">var </aside>serializer
            <aside>&ndash; /<a href="serializer.html">serializer</a>/<a href="serializer/sql.html">sql</a></aside>
        
    
            <a href="https://github.com/PersistentSS13/Nebula/blob/7b6f8493c22b657b410323bc01d7f2917a09e590/maps/outreach/../../mods/persistence/controllers/subsystems/persistence.dm#L74">
        <img src="git.png" width="16" height="16" title="maps&#x2F;outreach&#x2F;..&#x2F;..&#x2F;mods&#x2F;persistence&#x2F;controllers&#x2F;subsystems&#x2F;persistence.dm 74"/></a></h3>
        <p>The serializer impl for actually saving.</p><h3 id="var/was_entering_allowed"><aside class="declaration">var </aside>was_entering_allowed
            <aside>&ndash; </aside>
        
    
            <a href="https://github.com/PersistentSS13/Nebula/blob/7b6f8493c22b657b410323bc01d7f2917a09e590/maps/outreach/../../mods/persistence/controllers/subsystems/persistence.dm#L52">
        <img src="git.png" width="16" height="16" title="maps&#x2F;outreach&#x2F;..&#x2F;..&#x2F;mods&#x2F;persistence&#x2F;controllers&#x2F;subsystems&#x2F;persistence.dm 52"/></a></h3>
        <p>Holds the previous entering allowed state while we're running a save.</p><h2 id="proc">Proc Details</h2><h3 id="proc/AddToLimbo"><aside class="declaration">proc </aside>AddToLimbo<aside>(/list/things, key, limbo_type, metadata, metadata2, modify, initiator) 
        
    
            <a href="https://github.com/PersistentSS13/Nebula/blob/7b6f8493c22b657b410323bc01d7f2917a09e590/maps/outreach/../../mods/persistence/controllers/subsystems/persistence/persistence_storage.dm#L2">
        <img src="git.png" width="16" height="16" title="maps&#x2F;outreach&#x2F;..&#x2F;..&#x2F;mods&#x2F;persistence&#x2F;controllers&#x2F;subsystems&#x2F;persistence&#x2F;persistence_storage.dm 2"/></a></aside>
        </h3>
        <p>Add something to the off-world save.</p><h3 id="proc/LoadFromLimbo"><aside class="declaration">proc </aside>LoadFromLimbo<aside>(limbo_key, limbo_type, remove_after) 
        
    
            <a href="https://github.com/PersistentSS13/Nebula/blob/7b6f8493c22b657b410323bc01d7f2917a09e590/maps/outreach/../../mods/persistence/controllers/subsystems/persistence/persistence_storage.dm#L46">
        <img src="git.png" width="16" height="16" title="maps&#x2F;outreach&#x2F;..&#x2F;..&#x2F;mods&#x2F;persistence&#x2F;controllers&#x2F;subsystems&#x2F;persistence&#x2F;persistence_storage.dm 46"/></a></aside>
        </h3>
        <p>Load something from the off-world save.</p><h3 id="proc/LoadWorld"><aside class="declaration">proc </aside>LoadWorld<aside>() 
        
    
            <a href="https://github.com/PersistentSS13/Nebula/blob/7b6f8493c22b657b410323bc01d7f2917a09e590/maps/outreach/../../mods/persistence/controllers/subsystems/persistence.dm#L203">
        <img src="git.png" width="16" height="16" title="maps&#x2F;outreach&#x2F;..&#x2F;..&#x2F;mods&#x2F;persistence&#x2F;controllers&#x2F;subsystems&#x2F;persistence.dm 203"/></a></aside>
        </h3>
        <p>Load the last saved world.</p><h3 id="proc/LoadedSaveTimestamp"><aside class="declaration">proc </aside>LoadedSaveTimestamp<aside>() 
        
    
            <a href="https://github.com/PersistentSS13/Nebula/blob/7b6f8493c22b657b410323bc01d7f2917a09e590/maps/outreach/../../mods/persistence/controllers/subsystems/persistence.dm#L104">
        <img src="git.png" width="16" height="16" title="maps&#x2F;outreach&#x2F;..&#x2F;..&#x2F;mods&#x2F;persistence&#x2F;controllers&#x2F;subsystems&#x2F;persistence.dm 104"/></a></aside>
        </h3>
        <p>Timestamp of when the currently loaded save was made.</p><h3 id="proc/PrintDBStatus"><aside class="declaration">proc </aside>PrintDBStatus<aside>() 
        
    
            <a href="https://github.com/PersistentSS13/Nebula/blob/7b6f8493c22b657b410323bc01d7f2917a09e590/maps/outreach/../../mods/persistence/controllers/subsystems/persistence.dm#L93">
        <img src="git.png" width="16" height="16" title="maps&#x2F;outreach&#x2F;..&#x2F;..&#x2F;mods&#x2F;persistence&#x2F;controllers&#x2F;subsystems&#x2F;persistence.dm 93"/></a></aside>
        </h3>
        <p>Prints a description of the tables on the connected database into the chat for the usr calling this proc.</p><h3 id="proc/RemoveFromLimbo"><aside class="declaration">proc </aside>RemoveFromLimbo<aside>(limbo_key, limbo_type, initiator) 
        
    
            <a href="https://github.com/PersistentSS13/Nebula/blob/7b6f8493c22b657b410323bc01d7f2917a09e590/maps/outreach/../../mods/persistence/controllers/subsystems/persistence/persistence_storage.dm#L28">
        <img src="git.png" width="16" height="16" title="maps&#x2F;outreach&#x2F;..&#x2F;..&#x2F;mods&#x2F;persistence&#x2F;controllers&#x2F;subsystems&#x2F;persistence&#x2F;persistence_storage.dm 28"/></a></aside>
        </h3>
        <p>Remove something from the off-world save.</p><h3 id="proc/SaveExists"><aside class="declaration">proc </aside>SaveExists<aside>() 
        
    
            <a href="https://github.com/PersistentSS13/Nebula/blob/7b6f8493c22b657b410323bc01d7f2917a09e590/maps/outreach/../../mods/persistence/controllers/subsystems/persistence.dm#L97">
        <img src="git.png" width="16" height="16" title="maps&#x2F;outreach&#x2F;..&#x2F;..&#x2F;mods&#x2F;persistence&#x2F;controllers&#x2F;subsystems&#x2F;persistence.dm 97"/></a></aside>
        </h3>
        <p>Returns true if a save already exists on the DB</p><h3 id="proc/SaveWorld"><aside class="declaration">proc </aside>SaveWorld<aside>(save_initiator) 
        
    
            <a href="https://github.com/PersistentSS13/Nebula/blob/7b6f8493c22b657b410323bc01d7f2917a09e590/maps/outreach/../../mods/persistence/controllers/subsystems/persistence.dm#L139">
        <img src="git.png" width="16" height="16" title="maps&#x2F;outreach&#x2F;..&#x2F;..&#x2F;mods&#x2F;persistence&#x2F;controllers&#x2F;subsystems&#x2F;persistence.dm 139"/></a></aside>
        </h3>
        <p>Causes a world save to be started.</p><h3 id="proc/SetErrorTolerance"><aside class="declaration">proc </aside>SetErrorTolerance<aside>(tolerance_level) 
        
    
            <a href="https://github.com/PersistentSS13/Nebula/blob/7b6f8493c22b657b410323bc01d7f2917a09e590/maps/outreach/../../mods/persistence/controllers/subsystems/persistence.dm#L112">
        <img src="git.png" width="16" height="16" title="maps&#x2F;outreach&#x2F;..&#x2F;..&#x2F;mods&#x2F;persistence&#x2F;controllers&#x2F;subsystems&#x2F;persistence.dm 112"/></a></aside>
        </h3>
        <p>Sets the level of error tolerance to use during saves/loads. Default is PERSISTENCE_ERROR_TOLERANCE_NONE.</p><h3 id="proc/_after_save"><aside class="declaration">proc </aside>_after_save<aside>() 
        
    
            <a href="https://github.com/PersistentSS13/Nebula/blob/7b6f8493c22b657b410323bc01d7f2917a09e590/maps/outreach/../../mods/persistence/controllers/subsystems/persistence/persistence_saving.dm#L408">
        <img src="git.png" width="16" height="16" title="maps&#x2F;outreach&#x2F;..&#x2F;..&#x2F;mods&#x2F;persistence&#x2F;controllers&#x2F;subsystems&#x2F;persistence&#x2F;persistence_saving.dm 408"/></a></aside>
        </h3>
        <p>Runs the post-saving stuff</p><h3 id="proc/_apply_area_chunks"><aside class="declaration">proc </aside>_apply_area_chunks<aside>() 
        
    
            <a href="https://github.com/PersistentSS13/Nebula/blob/7b6f8493c22b657b410323bc01d7f2917a09e590/maps/outreach/../../mods/persistence/controllers/subsystems/persistence/persistence_loading.dm#L273">
        <img src="git.png" width="16" height="16" title="maps&#x2F;outreach&#x2F;..&#x2F;..&#x2F;mods&#x2F;persistence&#x2F;controllers&#x2F;subsystems&#x2F;persistence&#x2F;persistence_loading.dm 273"/></a></aside>
        </h3>
        <p>Applies areas to both loaded and default turfs inside the regions they cover.</p><h3 id="proc/_before_load"><aside class="declaration">proc </aside>_before_load<aside>() 
        
    
            <a href="https://github.com/PersistentSS13/Nebula/blob/7b6f8493c22b657b410323bc01d7f2917a09e590/maps/outreach/../../mods/persistence/controllers/subsystems/persistence/persistence_loading.dm#L70">
        <img src="git.png" width="16" height="16" title="maps&#x2F;outreach&#x2F;..&#x2F;..&#x2F;mods&#x2F;persistence&#x2F;controllers&#x2F;subsystems&#x2F;persistence&#x2F;persistence_loading.dm 70"/></a></aside>
        </h3>
        <p>Handles setting up db connections and etc..</p><h3 id="proc/_before_save"><aside class="declaration">proc </aside>_before_save<aside>(save_initiator) 
        
    
            <a href="https://github.com/PersistentSS13/Nebula/blob/7b6f8493c22b657b410323bc01d7f2917a09e590/maps/outreach/../../mods/persistence/controllers/subsystems/persistence/persistence_saving.dm#L365">
        <img src="git.png" width="16" height="16" title="maps&#x2F;outreach&#x2F;..&#x2F;..&#x2F;mods&#x2F;persistence&#x2F;controllers&#x2F;subsystems&#x2F;persistence&#x2F;persistence_saving.dm 365"/></a></aside>
        </h3>
        <p>Run the pre-save stuff</p><h3 id="proc/_block_entering"><aside class="declaration">proc </aside>_block_entering<aside>() 
        
    
            <a href="https://github.com/PersistentSS13/Nebula/blob/7b6f8493c22b657b410323bc01d7f2917a09e590/maps/outreach/../../mods/persistence/controllers/subsystems/persistence/persistence_saving.dm#L10">
        <img src="git.png" width="16" height="16" title="maps&#x2F;outreach&#x2F;..&#x2F;..&#x2F;mods&#x2F;persistence&#x2F;controllers&#x2F;subsystems&#x2F;persistence&#x2F;persistence_saving.dm 10"/></a></aside>
        </h3>
        <p>Keeps the previous state of 'enter_allowed' and set it to false. Returns TRUE if entering was currently allowed.</p><h3 id="proc/_deserialize_turfs"><aside class="declaration">proc </aside>_deserialize_turfs<aside>() 
        
    
            <a href="https://github.com/PersistentSS13/Nebula/blob/7b6f8493c22b657b410323bc01d7f2917a09e590/maps/outreach/../../mods/persistence/controllers/subsystems/persistence/persistence_loading.dm#L199">
        <img src="git.png" width="16" height="16" title="maps&#x2F;outreach&#x2F;..&#x2F;..&#x2F;mods&#x2F;persistence&#x2F;controllers&#x2F;subsystems&#x2F;persistence&#x2F;persistence_loading.dm 199"/></a></aside>
        </h3>
        <p>Deserialize cached top level wrapper datum/turf exclusively from the db cache.</p><h3 id="proc/_handle_critical_load_exception"><aside class="declaration">proc </aside>_handle_critical_load_exception<aside>(/exception/E, code_location) 
        
    
            <a href="https://github.com/PersistentSS13/Nebula/blob/7b6f8493c22b657b410323bc01d7f2917a09e590/maps/outreach/../../mods/persistence/controllers/subsystems/persistence/persistence_loading.dm#L7">
        <img src="git.png" width="16" height="16" title="maps&#x2F;outreach&#x2F;..&#x2F;..&#x2F;mods&#x2F;persistence&#x2F;controllers&#x2F;subsystems&#x2F;persistence&#x2F;persistence_loading.dm 7"/></a></aside>
        </h3>
        <p>Call in a catch block for critical/typically unrecoverable errors during load. Filters out the kind of exceptions we let through or not.</p><h3 id="proc/_handle_critical_save_exception"><aside class="declaration">proc </aside>_handle_critical_save_exception<aside>(/exception/E, code_location) 
        
    
            <a href="https://github.com/PersistentSS13/Nebula/blob/7b6f8493c22b657b410323bc01d7f2917a09e590/maps/outreach/../../mods/persistence/controllers/subsystems/persistence/persistence_saving.dm#L45">
        <img src="git.png" width="16" height="16" title="maps&#x2F;outreach&#x2F;..&#x2F;..&#x2F;mods&#x2F;persistence&#x2F;controllers&#x2F;subsystems&#x2F;persistence&#x2F;persistence_saving.dm 45"/></a></aside>
        </h3>
        <p>Call in a catch block for critical/typically unrecoverable errors during save. Filters out the kind of exceptions we let through or not.</p><h3 id="proc/_handle_recoverable_load_exception"><aside class="declaration">proc </aside>_handle_recoverable_load_exception<aside>(/exception/E, code_location) 
        
    
            <a href="https://github.com/PersistentSS13/Nebula/blob/7b6f8493c22b657b410323bc01d7f2917a09e590/maps/outreach/../../mods/persistence/controllers/subsystems/persistence/persistence_loading.dm#L15">
        <img src="git.png" width="16" height="16" title="maps&#x2F;outreach&#x2F;..&#x2F;..&#x2F;mods&#x2F;persistence&#x2F;controllers&#x2F;subsystems&#x2F;persistence&#x2F;persistence_loading.dm 15"/></a></aside>
        </h3>
        <p>Call in a catch block for recoverable or non-critical errors during load. Filters out the kind of exceptions we let through or not.</p><h3 id="proc/_handle_recoverable_save_exception"><aside class="declaration">proc </aside>_handle_recoverable_save_exception<aside>(/exception/E, code_location) 
        
    
            <a href="https://github.com/PersistentSS13/Nebula/blob/7b6f8493c22b657b410323bc01d7f2917a09e590/maps/outreach/../../mods/persistence/controllers/subsystems/persistence/persistence_saving.dm#L53">
        <img src="git.png" width="16" height="16" title="maps&#x2F;outreach&#x2F;..&#x2F;..&#x2F;mods&#x2F;persistence&#x2F;controllers&#x2F;subsystems&#x2F;persistence&#x2F;persistence_saving.dm 53"/></a></aside>
        </h3>
        <p>Call in a catch block for recoverable or non-critical errors during save. Filters out the kind of exceptions we let through or not.</p><h3 id="proc/_pause_subsystems"><aside class="declaration">proc </aside>_pause_subsystems<aside>() 
        
    
            <a href="https://github.com/PersistentSS13/Nebula/blob/7b6f8493c22b657b410323bc01d7f2917a09e590/maps/outreach/../../mods/persistence/controllers/subsystems/persistence/persistence_saving.dm#L21">
        <img src="git.png" width="16" height="16" title="maps&#x2F;outreach&#x2F;..&#x2F;..&#x2F;mods&#x2F;persistence&#x2F;controllers&#x2F;subsystems&#x2F;persistence&#x2F;persistence_saving.dm 21"/></a></aside>
        </h3>
        <p>Handle pausing all subsystems before save</p><h3 id="proc/_restore_entering"><aside class="declaration">proc </aside>_restore_entering<aside>() 
        
    
            <a href="https://github.com/PersistentSS13/Nebula/blob/7b6f8493c22b657b410323bc01d7f2917a09e590/maps/outreach/../../mods/persistence/controllers/subsystems/persistence/persistence_saving.dm#L16">
        <img src="git.png" width="16" height="16" title="maps&#x2F;outreach&#x2F;..&#x2F;..&#x2F;mods&#x2F;persistence&#x2F;controllers&#x2F;subsystems&#x2F;persistence&#x2F;persistence_saving.dm 16"/></a></aside>
        </h3>
        <p>Restore the previous state of 'enter_allowed'. Returns the restored value of 'enter_allowed'.</p><h3 id="proc/_restore_zlevel_structure"><aside class="declaration">proc </aside>_restore_zlevel_structure<aside>() 
        
    
            <a href="https://github.com/PersistentSS13/Nebula/blob/7b6f8493c22b657b410323bc01d7f2917a09e590/maps/outreach/../../mods/persistence/controllers/subsystems/persistence/persistence_loading.dm#L81">
        <img src="git.png" width="16" height="16" title="maps&#x2F;outreach&#x2F;..&#x2F;..&#x2F;mods&#x2F;persistence&#x2F;controllers&#x2F;subsystems&#x2F;persistence&#x2F;persistence_loading.dm 81"/></a></aside>
        </h3>
        <p>Assign the right z-level index to the right level.</p><h3 id="proc/_resume_subsystems"><aside class="declaration">proc </aside>_resume_subsystems<aside>() 
        
    
            <a href="https://github.com/PersistentSS13/Nebula/blob/7b6f8493c22b657b410323bc01d7f2917a09e590/maps/outreach/../../mods/persistence/controllers/subsystems/persistence/persistence_saving.dm#L33">
        <img src="git.png" width="16" height="16" title="maps&#x2F;outreach&#x2F;..&#x2F;..&#x2F;mods&#x2F;persistence&#x2F;controllers&#x2F;subsystems&#x2F;persistence&#x2F;persistence_saving.dm 33"/></a></aside>
        </h3>
        <p>Handles resuming all subsystems post-save</p><h3 id="proc/_run_after_deserialize"><aside class="declaration">proc </aside>_run_after_deserialize<aside>() 
        
    
            <a href="https://github.com/PersistentSS13/Nebula/blob/7b6f8493c22b657b410323bc01d7f2917a09e590/maps/outreach/../../mods/persistence/controllers/subsystems/persistence/persistence_loading.dm#L149">
        <img src="git.png" width="16" height="16" title="maps&#x2F;outreach&#x2F;..&#x2F;..&#x2F;mods&#x2F;persistence&#x2F;controllers&#x2F;subsystems&#x2F;persistence&#x2F;persistence_loading.dm 149"/></a></aside>
        </h3>
        <p>Sort z-levels on whether they got a mapped z indice, or not
Runs after deserialize on all the loaded atoms.</p><h3 id="proc/_save_areas"><aside class="declaration">proc </aside>_save_areas<aside>(/list/z_transform) 
        
    
            <a href="https://github.com/PersistentSS13/Nebula/blob/7b6f8493c22b657b410323bc01d7f2917a09e590/maps/outreach/../../mods/persistence/controllers/subsystems/persistence/persistence_saving.dm#L261">
        <img src="git.png" width="16" height="16" title="maps&#x2F;outreach&#x2F;..&#x2F;..&#x2F;mods&#x2F;persistence&#x2F;controllers&#x2F;subsystems&#x2F;persistence&#x2F;persistence_saving.dm 261"/></a></aside>
        </h3>
        <p>Amount of turfs waiting for a commit
The total count of zlevels we're saving
Saves area stuff</p><h3 id="proc/_save_bank_accounts"><aside class="declaration">proc </aside>_save_bank_accounts<aside>() 
        
    
            <a href="https://github.com/PersistentSS13/Nebula/blob/7b6f8493c22b657b410323bc01d7f2917a09e590/maps/outreach/../../mods/persistence/controllers/subsystems/persistence/persistence_saving.dm#L341">
        <img src="git.png" width="16" height="16" title="maps&#x2F;outreach&#x2F;..&#x2F;..&#x2F;mods&#x2F;persistence&#x2F;controllers&#x2F;subsystems&#x2F;persistence&#x2F;persistence_saving.dm 341"/></a></aside>
        </h3>
        <p>Save bank account stuff</p><h3 id="proc/_save_extensions"><aside class="declaration">proc </aside>_save_extensions<aside>() 
        
    
            <a href="https://github.com/PersistentSS13/Nebula/blob/7b6f8493c22b657b410323bc01d7f2917a09e590/maps/outreach/../../mods/persistence/controllers/subsystems/persistence/persistence_saving.dm#L323">
        <img src="git.png" width="16" height="16" title="maps&#x2F;outreach&#x2F;..&#x2F;..&#x2F;mods&#x2F;persistence&#x2F;controllers&#x2F;subsystems&#x2F;persistence&#x2F;persistence_saving.dm 323"/></a></aside>
        </h3>
        <p>Saves extension wrapper stuff</p><h3 id="proc/_save_turfs"><aside class="declaration">proc </aside>_save_turfs<aside>(/list/z_transform) 
        
    
            <a href="https://github.com/PersistentSS13/Nebula/blob/7b6f8493c22b657b410323bc01d7f2917a09e590/maps/outreach/../../mods/persistence/controllers/subsystems/persistence/persistence_saving.dm#L166">
        <img src="git.png" width="16" height="16" title="maps&#x2F;outreach&#x2F;..&#x2F;..&#x2F;mods&#x2F;persistence&#x2F;controllers&#x2F;subsystems&#x2F;persistence&#x2F;persistence_saving.dm 166"/></a></aside>
        </h3>
        <p>Saves all the turfs marked for saving in the world.
!!!!!!!!!!!!!!!!!!!!!!!
! - HOT CODE BELOW - !!
!!!!!!!!!!!!!!!!!!!!!!!</p><h3 id="proc/_setup_default_turfs"><aside class="declaration">proc </aside>_setup_default_turfs<aside>(/list/turfs_loaded) 
        
    
            <a href="https://github.com/PersistentSS13/Nebula/blob/7b6f8493c22b657b410323bc01d7f2917a09e590/maps/outreach/../../mods/persistence/controllers/subsystems/persistence/persistence_loading.dm#L227">
        <img src="git.png" width="16" height="16" title="maps&#x2F;outreach&#x2F;..&#x2F;..&#x2F;mods&#x2F;persistence&#x2F;controllers&#x2F;subsystems&#x2F;persistence&#x2F;persistence_loading.dm 227"/></a></aside>
        </h3>
        <p>TODO</p><h3 id="proc/_update_limbo_state"><aside class="declaration">proc </aside>_update_limbo_state<aside>() 
        
    
            <a href="https://github.com/PersistentSS13/Nebula/blob/7b6f8493c22b657b410323bc01d7f2917a09e590/maps/outreach/../../mods/persistence/controllers/subsystems/persistence/persistence_loading.dm#L190">
        <img src="git.png" width="16" height="16" title="maps&#x2F;outreach&#x2F;..&#x2F;..&#x2F;mods&#x2F;persistence&#x2F;controllers&#x2F;subsystems&#x2F;persistence&#x2F;persistence_loading.dm 190"/></a></aside>
        </h3>
        <p>Clean up limbo by removing any characters present in the gameworld. This may occur if the server does not save after
a player enters limbo.</p><h3 id="proc/prepare_atmos_for_save"><aside class="declaration">proc </aside>prepare_atmos_for_save<aside>() 
        
    
            <a href="https://github.com/PersistentSS13/Nebula/blob/7b6f8493c22b657b410323bc01d7f2917a09e590/maps/outreach/../../mods/persistence/controllers/subsystems/persistence/persistence_saving.dm#L65">
        <img src="git.png" width="16" height="16" title="maps&#x2F;outreach&#x2F;..&#x2F;..&#x2F;mods&#x2F;persistence&#x2F;controllers&#x2F;subsystems&#x2F;persistence&#x2F;persistence_saving.dm 65"/></a></aside>
        </h3>
        <p>Make atmos store it's air values so we can properly save them per atmos atom.</p><h3 id="proc/prepare_limbo_for_save"><aside class="declaration">proc </aside>prepare_limbo_for_save<aside>() 
        
    
            <a href="https://github.com/PersistentSS13/Nebula/blob/7b6f8493c22b657b410323bc01d7f2917a09e590/maps/outreach/../../mods/persistence/controllers/subsystems/persistence/persistence_saving.dm#L75">
        <img src="git.png" width="16" height="16" title="maps&#x2F;outreach&#x2F;..&#x2F;..&#x2F;mods&#x2F;persistence&#x2F;controllers&#x2F;subsystems&#x2F;persistence&#x2F;persistence_saving.dm 75"/></a></aside>
        </h3>
        <p>Update the list of things in limbo and not in limbo, so they don't get saved in 2 different states.</p></main>
<footer>
    nebula.dme
    <a href="https://github.com/PersistentSS13/Nebula/tree/7b6f8493c22b657b410323bc01d7f2917a09e590">7b6f849</a>
        (dev) &mdash; <a href="https://github.com/SpaceManiac/SpacemanDMM/blob/master/src/dmdoc/README.md">dmdoc 1.4.1</a></footer>
</body>
</html>
